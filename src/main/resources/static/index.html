<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="referrer" content="no-referrer" />
    <title>VisGroup25</title>
    <link href="css/bootstrap-combined.min.css" rel="stylesheet"/>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/chart.js"></script>
    <script src="js/global.js"></script>
</head>
<body>
<div class="container-fluid">
    <div class="row-fluid">
        <div class="span12">
            <div class="navbar">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a data-target=".navbar-responsive-collapse" data-toggle="collapse" class="btn btn-navbar"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></a>
                        <a href="#" class="brand">VisGroup25</a>
                        <div class="nav-collapse collapse navbar-responsive-collapse">
                            <ul class="nav">
                                <li class="active">
                                    <a href="#">Home</a>
                                </li>
                                <li>
                                    <a href="up.html?name=LexBurner">User</a>
                                </li>
                                <li>
                                    <a href="compare.html?name=LexBurner&name2=敖厂长">Compare</a>
                                </li>
                            </ul>
                            <ul class="nav pull-right">
                                <li>
                                    <a href="#">Link3</a>
                                </li>
                                <li class="divider-vertical">
                                </li>
                                <li class="dropdown">
                                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">Menu<strong class="caret"></strong></a>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a href="#">Nav1</a>
                                        </li>
                                        <li>
                                            <a href="#">Nav2</a>
                                        </li>
                                        <li>
                                            <a href="#">other</a>
                                        </li>
                                        <li class="divider">
                                        </li>
                                        <li class="nav-header">
                                            label
                                        </li>
                                        <li>
                                            <a href="#">Link1</a>
                                        </li>
                                        <li>
                                            <a href="#">Link2</a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="hero-unit" contenteditable="false">
                <h1>Visualization On Famous Bilibili UP Masters</h1>
                <br/>
                <p><a class="btn btn-primary btn-large" href="up.html?name=LexBurner">Quick Access »</a></p>
            </div>
            <div id="search_form" class="form-search">
                <div class="alert alert-info">
                    <button type="button" class="close" data-dismiss="alert">×</button>
                    <h4>
                        Tips:
                    </h4>
                    <br/>
                    <p>1. Input a Name or ID and Click "Visualize" to  Visualize it.</p>
                    <p>2. Click a List Item to Visualize it.</p>
                </div>
                <input id="search_input" class="input-medium search-query" type="text" />
                <button id="search_up" onclick="onSubmit()" class="btn">Visualize</button>
            </div>
            <table class="table table-striped table-hover" contenteditable="false">
                <thead>
                <tr>
                    <th>UP Name</th>
                    <th>UP ID</th>
                </tr>
                </thead>
                <tbody id = "up_table">
<!--                <tr>-->
<!--                    <td>Mr.Truth</td>-->
<!--                </tr>-->
                </tbody>
            </table>

        </div>
    </div>
</div>
</body>
<script>
    var urlPrefix = getUrlPrefix(undefined);
    $(function () {
        listAllUps();
    });

    //on click
    function onSubmit() {
        var name = $("#search_input").val();
        if (name === undefined || name === null || name === "") {
            // listAllUps();
            return;
        }
        jumpToUp(name);
    }

    //load all UP master, refresh table, for jump to html.
    function listAllUps() {
        $.ajax({
            url: "up_basic_all",
            type: "GET",
            success: function (data) {
                if (data.errcode === 0) {
                    onUPAllGot(data);
                } else {
                    alert("Cannot get all UP data");
                }
            },
            error:function(e) {
                alert("network error");
            }
        });
    }

    //ajax callback
    function onUPAllGot(data) {
        console.log("totally " + data.detailedUserList.length + " UP Masters.");
        var up_table = $("#up_table");
        up_table.html("");
        for (var i = 0; i < data.detailedUserList.length; i++) {
            var name = data.detailedUserList[i].name;
            up_table.append("<tr onclick=\"jumpToUp('" + name + "')\">" +
                "<td>" +
                "<img class='img-responsive img-circle' alt='Avatar' width='40' height='40' src='" + data.detailedUserList[i].face + "' />" +
                data.detailedUserList[i].name  + "</td>" +
                "<td>" + data.detailedUserList[i].mid  + "</td>" +
                "</tr>");
        }
    }

    //jump tp the page of exact UP
    function jumpToUp(name) {
        urlPrefix = getUrlPrefix(urlPrefix);
        window.open(urlPrefix + "/up.html?name=" + name);
    }
</script>
</html>